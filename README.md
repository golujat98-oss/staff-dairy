# Staff Diary (Complete - Local Backend)
This is a simple, complete React + Vite app scaffolding for "Staff Diary".
It uses a localStorage based fake backend so it runs without external services.

## Run locally
1. Install dependencies:
   npm install
2. Start dev server:
   npm run dev
3. Build for production:
   npm run build

## Notes
- This version uses localStorage as a backend for demo and offline usage.
- You can later replace localStorage functions with Firebase or any real backend.


## ✅ Added: Attendance Approval Workflow (v2)

New files added:
- `src/components/ApprovalRequests.jsx` — Admin UI to view & approve/reject attendance requests.
- `src/pages/Attendance.jsx` — Updated to create check-in/check-out requests (pending approval).
- `src/supabase.js` — helper `createAttendanceRequest()` added.

### Database (Supabase) - Required Tables
Run the included migration `SUPABASE-MIGRATION.sql` (updated) or create tables:

```sql
-- attendance_requests table
CREATE TABLE IF NOT EXISTS attendance_requests (
  id bigint generated by default as identity primary key,
  staff_id bigint,
  staff_name text,
  staff_code text,
  request_type text, -- 'checkin' | 'checkout'
  requested_time timestamptz,
  status text,
  note text,
  reviewed_at timestamptz
);

-- attendances table (if not present)
CREATE TABLE IF NOT EXISTS attendances (
  id bigint generated by default as identity primary key,
  staff_id bigint,
  checkin_time timestamptz,
  checkout_time timestamptz,
  status text
);
```

### How to test locally
1. Set up `.env` with `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`.
2. `npm install` and `npm run dev`
3. Open the app, login as staff (ensure `localStorage.current_staff` exists for quick testing) and use **Request Check-In**.
4. Open Admin dashboard and include the `ApprovalRequests` component into a page to approve/reject.

### GitHub Push (manual)
To push this updated project to GitHub:

```bash
# initialize git (if not already) and push
git init
git add .
git commit -m "Add attendance approval workflow and ApprovalRequests component"
git branch -M main
git remote add origin https://github.com/<your-username>/<your-repo>.git
git push -u origin main
```

If you want me to push directly, provide a **GitHub repository URL** and a **personal access token** with `repo` permissions and I will provide a script using it. (Keep token private!)


## ✅ Role-Based Access Control (RBAC) & Admin Management

### Roles:
- `superadmin` - Owner (full control)
- `admin` - Can manage staff, approve attendance, manage salary
- `manager` - Can approve attendance and view staff in their scope
- `staff` - Can request attendance, view own data

### How to use:
1. Run the migration `SUPABASE-MIGRATION.sql` in your Supabase SQL editor to create `users` table and seed a superadmin.
2. Login (or set `localStorage.current_staff` for quick testing):
   ```js
   localStorage.setItem('current_staff', JSON.stringify({id:1,name:'Golu',email:'owner@example.com',role:'superadmin',code:'SD-000'}));
   ```
3. Visit Admin Management page (`/admin-management`) to create sub-admins (admin/manager).
4. Use `src/utils/rbac.js` helper to check permissions in UI components: `can(user.role, 'approveAttendance')`.

Security note: Passwords must be hashed server-side. This demo uses direct insertion for simplicity.
